var logging="none";log=function(){try{Array.prototype.join.call(arguments," ")}catch(e){alert("Oops...the browser has encountered the following unexpected error:\n"+e.message+"\n\nPlease try clearing your browser cache and reload the page.")}},logToScreen=function(e){var o=document.getElementById("logging");if(!o){var t=document.createElement("div");t.id="logging";var a=document.createElement("h3");a.innerHTML="Application Logs",t.appendChild(a),document.getElementsByTagName("BODY")[0].appendChild(t)}var n=document.createElement("p");n.innerHTML=e,document.getElementById("logging").appendChild(n)},window.addEventListener("online",function(e){log("Online")},!0),window.addEventListener("offline",function(e){log("Offline")},!0),showCacheStatus=function(e){return statusMessages=["Uncached","Idle","Checking","Downloading","UpdateReady","Obsolete"],statusMessages[e]},window.applicationCache.onchecking=function(e){log("Checking for application update")},window.applicationCache.onnoupdate=function(e){log("No application update found")},window.applicationCache.onobsolete=function(e){log("Application obsolete")},window.applicationCache.ondownloading=function(e){log("Downloading application update")},window.applicationCache.oncached=function(e){log("Application cached")},window.applicationCache.onupdateready=function(e){log("Application cache updated"),location.reload(!1),log("Reloaded page from cache")},window.applicationCache.onerror=function(e){navigator.onLine?log("Application cache error: ("+e.message+")"):log("Navigator is Offline")},checkForUpdates=function(){try{log("Executing window.applicationCache.update()"),window.applicationCache.update()}catch(e){log("Error has occured from executing window.applicationCache.update()"),applicationCache.onerror(e)}},onload=function(e){return window.applicationCache?window.localStorage?(log("Initial cache status: "+showCacheStatus(window.applicationCache.status)),log("Checking for cache updates from server"),void checkForUpdates()):void alert("Unfortunately Local Storage (window.localStorage) feature is not supported by your current browser. This application requires this to function properly. Please try using the latest Google Chrome browser."):void alert("Unfortunately Offline Applications (window.applicationCache) feature is not supported by your current browser. This application requires this to function properly. Please try using the latest Google Chrome browser.")},log("Initialising global constants (photoWidth and photoHeight) and variables (video, soundCamera, canvas)...");var photoWidth=640,photoHeight=480,buttonText="I Parked Here",video=document.getElementById("tempVideo"),soundCamera=document.getElementById("tempAudio"),canvas=document.getElementById("tempCanvas"),btnSaveCurrentLocation=document.getElementById("btnSaveCurrentLocation"),ctx=canvas.getContext("2d"),localMediaStream=null;canvas.width=photoHeight,canvas.height=photoWidth,animateBtnSaveCurrentLocation=function(e){e==buttonText?(btnSaveCurrentLocation.disabled=!1,btnSaveCurrentLocation.style.backgroundColor="#000000",btnSaveCurrentLocation.style.color="#ffffff"):(btnSaveCurrentLocation.disabled=!0,btnSaveCurrentLocation.style.backgroundColor="#ffffff",btnSaveCurrentLocation.style.color="#000000"),btnSaveCurrentLocation.innerHTML=e},saveCurrentLocation=function(){navigator.geolocation?(animateBtnSaveCurrentLocation("Awaiting GPS..."),soundCamera.play(),navigator.geolocation.getCurrentPosition(showPosition)):(log("Undefined navigator.geolocation"),alert("Unfortunately GPS (navigator.geolocation) feature is not supported by your current browser. This application requires this to function properly. Please try using the latest Google Chrome browser."))},getCurrentDateTime=function(){var e=new Date,o=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()+" @"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return o},getUserMedia=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:{width:photoWidth,height:photoHeight,facingMode:{exact:"environment"}}},function(e){video.src=window.URL.createObjectURL(e),localMediaStream=e,localMediaStream&&(video.style.display="block")},log):(log("Undefined navigator.getUserMedia"),alert("Unfortunately Photo Capture (navigator.getUserMedia) feature is not supported by your current browser. This application requires this to function properly. Please try using the latest Google Chrome browser."))},getPhotoFromCanvas=function(){return localMediaStream?(ctx.drawImage(video,0,0,photoHeight,photoWidth),canvas.toDataURL("image/webp")):null},showPosition=function(e){var o=getCurrentDateTime();storeLocation(o,e.coords.latitude,e.coords.longitude,getPhotoFromCanvas()),showLocationHistory()},storeLocation=function(e,o,t,a){var n=JSON.parse(localStorage.locations||"[]");n.push({datetime:e,latitude:o,longitude:t,photo:a}),localStorage.locations=JSON.stringify(n),log("Stored currentDateTime, geolocation, photo to localStorage.locations"),animateBtnSaveCurrentLocation(buttonText)},showLocationHistory=function(){var e=JSON.parse(localStorage.locations||"[]"),o=document.getElementById("locationHistory");if(e.length>0){o.style.display="block";for(var t=document.getElementById("locationHistoryBody");t.hasChildNodes();)t.removeChild(t.firstChild)}else o.style.display="none";for(i=e.length-1;i>=0;i--){var a=document.createElement("tr");a.setAttribute("id","row"+i);var n=document.createElement("td");n=document.createElement("td"),n.innerHTML='<a onclick="javascript:clearLocation('+i+')"><img src="media/iconDelete.png" alt="Delete" height="40" width="40" /></a>',a.appendChild(n),n=document.createElement("td"),n.innerHTML=e[i].datetime,a.appendChild(n),n=document.createElement("td"),n.innerHTML=e[i].latitude+", "+e[i].longitude,a.appendChild(n),n=document.createElement("td"),n.innerHTML='<a href="https://www.google.com/maps/search/?api=1&query='+e[i].latitude+","+e[i].longitude+'">'+(e[i].photo?'<div class="photo"><img src="'+e[i].photo+'" title="Take me there" alt="Take me there" width="100%" /></div>':"Take me there")+"</a>",a.appendChild(n),t.appendChild(a)}},reloadPage=function(){location.reload()},clearLocationHistory=function(){window.localStorage&&window.localStorage.locations&&confirm("Permanently DELETE ALL rows from the table?")&&(localStorage.removeItem("locations"),log("Removed localStorage.locations"),showLocationHistory())},clearLocation=function(e){if(window.localStorage&&window.localStorage.locations){var o=JSON.parse(localStorage.locations||"[]");o.splice(e,1),localStorage.locations=JSON.stringify(o),log("Removed localStorage.locations["+e+"]"),showLocationHistory()}},log("Update text on 'I Parked Here' button"),animateBtnSaveCurrentLocation(buttonText),log("Binding 'I Parked Here' button and 'Delete ALL Location History' icon click event handlers"),document.getElementById("btnSaveCurrentLocation").onclick=saveCurrentLocation,document.getElementById("btnClearLocationHistory").onclick=clearLocationHistory,log("Rendering Location History table"),showLocationHistory(),log("Initiating Video and Canvas"),getUserMedia(),log("Application is ready");